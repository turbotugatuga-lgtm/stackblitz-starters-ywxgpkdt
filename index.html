<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Solana Airdrop Premium</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white">
<div class="max-w-4xl mx-auto p-6">
  <h1 class="text-3xl font-bold mb-4 text-purple-400">ðŸš€ Solana Airdrop Premium</h1>

  <!-- Wallet Connect -->
  <div class="flex items-center gap-2 mb-4">
    <button id="connectBtn" class="px-4 py-2 bg-purple-600 rounded-lg hover:bg-purple-700">Connect Phantom Wallet</button>
    <button id="disconnectBtn" class="px-4 py-2 bg-red-600 rounded-lg hover:bg-red-700 hidden">Disconnect Wallet</button>
    <span id="walletAddress" class="ml-4"></span>
  </div>

  <!-- Token Select -->
  <div class="mb-4">
    <label class="block font-medium mb-1">Select Token:</label>
    <select id="tokenSelect" class="w-full border border-gray-700 rounded p-2 bg-gray-800 text-white">
      <option>Connect wallet...</option>
    </select>
  </div>

  <!-- Amount -->
  <div class="mb-4">
    <label class="block font-medium mb-1">Amount to send:</label>
    <input id="amountInput" type="number" min="0" step="any" class="w-full border border-gray-700 rounded p-2 bg-gray-800 text-white" placeholder="e.g. 10" />
  </div>

  <!-- Recipients -->
  <div class="mb-4">
    <label class="block font-medium mb-1">Recipients (paste or upload .txt file):</label>
    <textarea id="recipients" class="w-full border border-gray-700 rounded p-2 bg-gray-800 text-white" rows="4" placeholder="Paste addresses separated by line"></textarea>
    <input id="fileInput" type="file" accept=".txt" class="mt-2 p-1 bg-gray-700 rounded" />
  </div>

  <!-- Fees -->
  <div class="mb-4 p-3 border border-gray-700 rounded bg-gray-800">
    <p>ðŸ’° Service Fee: <b>0.00005 SOL per wallet</b> (goes to admin)</p>
    <p id="costInfo" class="mt-1">Total cost: -</p>
  </div>

  <!-- Send Button -->
  <button id="sendBtn" class="w-full px-4 py-2 bg-green-600 rounded-lg hover:bg-green-700 mb-4">Send Tokens</button>

  <!-- Logs -->
  <pre id="log" class="bg-black text-green-400 p-3 rounded h-64 overflow-y-auto text-sm"></pre>
</div>

<script type="module">
import { Connection, PublicKey, Transaction, SystemProgram } from "https://esm.sh/@solana/web3.js@1.95.4";
import * as splToken from "https://esm.sh/@solana/spl-token@0.4.6";

let wallet = null;
const feeWallet = new PublicKey("9Sexip38yhfeZD2EBDQkVRicZSY6eSK3cXxgDkgFVf8b");
const rpcUrl = "https://solana-mainnet.g.alchemy.com/v2/YOUR_ALCHEMY_KEY"; 
const connection = new Connection(rpcUrl, "confirmed");

const connectBtn = document.getElementById("connectBtn");
const disconnectBtn = document.getElementById("disconnectBtn");
const walletAddressEl = document.getElementById("walletAddress");
const tokenSelect = document.getElementById("tokenSelect");
const amountInput = document.getElementById("amountInput");
const recipientsEl = document.getElementById("recipients");
const fileInput = document.getElementById("fileInput");
const costInfo = document.getElementById("costInfo");
const sendBtn = document.getElementById("sendBtn");
const logEl = document.getElementById("log");
const log = msg => { logEl.textContent += msg + "\n"; logEl.scrollTop = logEl.scrollHeight; };

// Connect Wallet
connectBtn.onclick = async () => {
  try {
    const provider = window.solana;
    if (!provider?.isPhantom) { alert("Install Phantom Wallet"); return; }
    const resp = await provider.connect();
    wallet = new PublicKey(resp.publicKey.toString());
    walletAddressEl.textContent = wallet.toBase58();
    connectBtn.classList.add("hidden");
    disconnectBtn.classList.remove("hidden");
    await loadTokens();
  } catch(e) { log("Connect error: " + e.message); }
};

// Disconnect Wallet
disconnectBtn.onclick = () => {
  wallet = null;
  walletAddressEl.textContent = "";
  tokenSelect.innerHTML = '<option>Connect wallet...</option>';
  connectBtn.classList.remove("hidden");
  disconnectBtn.classList.add("hidden");
  log("Wallet disconnected");
};

// Load Tokens
async function loadTokens() {
  tokenSelect.innerHTML = "";
  try {
    // SOL
    const solBalance = await connection.getBalance(wallet);
    const solOption = document.createElement("option");
    solOption.value = "SOL";
    solOption.textContent = `SOL â€” balance: ${(solBalance / 1e9).toFixed(6)}`;
    tokenSelect.appendChild(solOption);

    // SPL Tokens
    const tokenAccounts = await connection.getParsedTokenAccountsByOwner(wallet, {
      programId: splToken.TOKEN_PROGRAM_ID
    });

    tokenAccounts.value.forEach(acc => {
      const info = acc.account.data.parsed.info;
      const mint = info.mint;
      const amount = info.tokenAmount?.uiAmount || 0;
      if (amount > 0) {
        const option = document.createElement("option");
        option.value = mint;
        option.textContent = `${mint} â€” balance: ${amount}`;
        tokenSelect.appendChild(option);
      }
    });

    if(tokenAccounts.value.length === 0){
      const opt = document.createElement("option");
      opt.textContent = "No SPL tokens found";
      tokenSelect.appendChild(opt);
    }
  } catch(e) {
    log("Error loading tokens: " + e.message);
    const opt = document.createElement("option");
    opt.textContent = "Error loading tokens";
    tokenSelect.appendChild(opt);
  }
}

// Update cost
function updateCost() {
  const recipients = recipientsEl.value.trim().split(/\n+/).filter(x=>x);
  const totalFee = recipients.length * 0.00005;
  costInfo.textContent = `Wallets: ${recipients.length} | Fee: ${totalFee.toFixed(6)} SOL + network gas`;
}
recipientsEl.addEventListener("input", updateCost);
fileInput.addEventListener("change", async e => {
  const text = await e.target.files[0].text();
  recipientsEl.value = text;
  updateCost();
});

// Send Tokens
sendBtn.onclick = async () => {
  if (!wallet) { alert("Connect wallet first!"); return; }

  const recipients = recipientsEl.value.trim().split(/\n+/).filter(x=>x);
  const amount = parseFloat(amountInput.value);
  const token = tokenSelect.value;

  if (!recipients.length || !amount) { alert("Fill recipients and amount"); return; }

  for (let addr of recipients) {
    try {
      const to = new PublicKey(addr);

      if (token === "SOL") {
        const tx = new Transaction().add(
          SystemProgram.transfer({ fromPubkey: wallet, toPubkey: to, lamports: amount*1e9 }),
          SystemProgram.transfer({ fromPubkey: wallet, toPubkey: feeWallet, lamports: 0.00005*1e9 })
        );
        const { signature } = await window.solana.signAndSendTransaction(tx);
        log(`Sent SOL to ${addr}, tx: ${signature}`);
      } else {
        const mint = new PublicKey(token);
        const fromTokenAcc = await splToken.getAssociatedTokenAddress(mint, wallet);
        const toTokenAcc = await splToken.getAssociatedTokenAddress(mint, to);
        const ix = splToken.createTransferInstruction(fromTokenAcc, toTokenAcc, wallet, amount * 10**6);
        const tx = new Transaction().add(ix,
          SystemProgram.transfer({ fromPubkey: wallet, toPubkey: feeWallet, lamports: 0.00005*1e9 })
        );
        const { signature } = await window.solana.signAndSendTransaction(tx);
        log(`Sent SPL ${token} to ${addr}, tx: ${signature}`);
      }
    } catch(e) { log(`Error sending to ${addr}: ${e.message}`); }
  }
};
</script>
</body>
</html>
