<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>DApp Solana</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-8">

  <h1 class="text-2xl font-bold mb-6">DApp Solana</h1>

  <!-- Botão conectar/desconectar -->
  <button id="connectBtn" class="px-6 py-2 bg-purple-600 text-white rounded mb-4">
    Conectar Phantom
  </button>

  <!-- Conteúdo -->
  <div id="appContent" class="hidden w-full max-w-lg space-y-6">
    <div class="bg-white p-4 shadow rounded">
      <p><strong>Carteira:</strong> <span id="walletAddress"></span></p>
      <p><strong>SOL:</strong> <span id="solBalance"></span></p>
    </div>

    <div class="bg-white p-4 shadow rounded">
      <h2 class="font-semibold mb-2">Tokens SPL:</h2>
      <ul id="tokenList" class="space-y-2"></ul>
    </div>
  </div>

  <script type="module">
    import {
      Connection,
      PublicKey,
      LAMPORTS_PER_SOL
    } from "https://esm.sh/@solana/web3.js";

    // RPC com API Key (Helius, Alchemy, Triton, etc.)
    const HELIUS_API_KEY = "DQTIx_O7s4BONKlPJ7FWu";
    const RPC = `https://mainnet.helius-rpc.com/?api-key=${HELIUS_API_KEY}`;
    const connection = new Connection(RPC);

    let walletPublicKey = null;

    const connectBtn = document.getElementById("connectBtn");
    const appContent = document.getElementById("appContent");
    const walletAddress = document.getElementById("walletAddress");
    const solBalance = document.getElementById("solBalance");
    const tokenList = document.getElementById("tokenList");

    // Conectar/Desconectar
    connectBtn.onclick = async () => {
      if (!walletPublicKey) {
        await connectWallet();
      } else {
        disconnectWallet();
      }
    };

    async function connectWallet() {
      if (!window.solana || !window.solana.isPhantom) {
        alert("Instale a Phantom Wallet!");
        return;
      }
      try {
        const resp = await window.solana.connect();
        walletPublicKey = new PublicKey(resp.publicKey.toString());
        walletAddress.textContent = walletPublicKey.toBase58();
        connectBtn.textContent = "Desconectar";
        appContent.classList.remove("hidden");

        await loadBalance();
        await loadTokens();
      } catch (e) {
        console.error("Erro ao conectar:", e);
      }
    }

    function disconnectWallet() {
      walletPublicKey = null;
      walletAddress.textContent = "";
      solBalance.textContent = "";
      tokenList.innerHTML = "";
      connectBtn.textContent = "Conectar Phantom";
      appContent.classList.add("hidden");
    }

    async function loadBalance() {
      const balance = await connection.getBalance(walletPublicKey);
      solBalance.textContent = (balance / LAMPORTS_PER_SOL).toFixed(4);
    }

    async function loadTokens() {
      try {
        const accounts = await connection.getParsedTokenAccountsByOwner(
          walletPublicKey,
          { programId: new PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA") }
        );

        tokenList.innerHTML = "";

        if (accounts.value.length === 0) {
          tokenList.innerHTML = "<li>Nenhum token SPL encontrado.</li>";
          return;
        }

        accounts.value.forEach(acc => {
          const info = acc.account.data.parsed.info;
          const mint = info.mint;
          const amount = info.tokenAmount.uiAmount;
          const decimals = info.tokenAmount.decimals;

          const li = document.createElement("li");
          li.textContent = `Mint: ${mint} | Qtde: ${amount}`;
          tokenList.appendChild(li);
        });
      } catch (err) {
        console.error("Erro ao carregar tokens:", err);
        tokenList.innerHTML = "<li>Erro ao carregar tokens.</li>";
      }
    }
  </script>
</body>
</html>

