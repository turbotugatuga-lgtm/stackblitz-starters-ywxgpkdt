<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Airdrop TurboTuga</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import { Connection, clusterApiUrl, PublicKey } from "https://esm.sh/@solana/web3.js@1.95.3";
    import * as splToken from "https://esm.sh/@solana/spl-token@0.3.9";

    const connection = new Connection(clusterApiUrl("devnet"), "confirmed");
    let wallet = null;
    const feeWallet = new PublicKey("9Sexip38yhfeZD2EBDQkVRicZSY6eSK3cXxgDkgFVf8b");
    let selectedToken = null;

    async function connectWallet() {
      if (!window.solana) {
        alert("Instale a carteira Phantom.");
        return;
      }
      try {
        const resp = await window.solana.connect();
        wallet = resp.publicKey;
        document.getElementById("walletAddress").innerText = wallet.toBase58();
        loadTokens();
      } catch (err) {
        console.error(err);
      }
    }

    async function loadTokens() {
      try {
        document.getElementById("tokenSelect").innerHTML = "";
        const tokenAccounts = await connection.getParsedTokenAccountsByOwner(wallet, { programId: splToken.TOKEN_PROGRAM_ID });
        if (tokenAccounts.value.length === 0) {
          document.getElementById("tokenSelect").innerHTML = "<option>Nenhum token encontrado</option>";
          return;
        }
        tokenAccounts.value.forEach(acc => {
          const info = acc.account.data.parsed.info;
          const mint = info.mint;
          const amount = info.tokenAmount.uiAmount;
          const option = document.createElement("option");
          option.value = mint;
          option.textContent = `${mint} ‚Äî saldo: ${amount}`;
          document.getElementById("tokenSelect").appendChild(option);
        });
      } catch (e) {
        console.error("Erro ao carregar tokens", e);
      }
    }

    function updateFees() {
      const qty = parseFloat(document.getElementById("tokenAmount").value || "0");
      const walletsText = document.getElementById("wallets").value.trim();
      const wallets = walletsText.split("\n").filter(w => w);
      const count = wallets.length;
      const fixedFee = 0.00005 * count;
      const networkFee = 0.000005 * count;
      document.getElementById("fees").innerText =
        `Taxa fixa: ${fixedFee.toFixed(6)} SOL + Gas estimado: ${networkFee.toFixed(6)} SOL`;
    }

    async function sendTokens() {
      const tokenMint = document.getElementById("tokenSelect").value;
      const qty = parseFloat(document.getElementById("tokenAmount").value);
      const walletsText = document.getElementById("wallets").value.trim();
      const wallets = walletsText.split("\n").filter(w => w);

      if (!tokenMint || !qty || wallets.length === 0) {
        alert("Preencha todos os campos.");
        return;
      }

      alert("üîî Envio real de tokens deve ser programado com transfer√™ncias SPL.\nAqui est√° apenas o fluxo com taxas calculadas.");
      console.log("Enviar", qty, "do token", tokenMint, "para", wallets, "com taxa para", feeWallet.toBase58());
    }

    window.connectWallet = connectWallet;
    window.updateFees = updateFees;
    window.sendTokens = sendTokens;
  </script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-6">
  <div class="max-w-3xl mx-auto bg-gray-800 p-6 rounded-2xl shadow-xl">
    <h1 class="text-2xl font-bold mb-4">üöÄ Airdrop TurboTuga</h1>
    <button onclick="connectWallet()" class="px-4 py-2 bg-indigo-600 rounded-lg hover:bg-indigo-700">
      Conectar Phantom
    </button>
    <p class="mt-2">Carteira conectada: <span id="walletAddress" class="font-mono"></span></p>

    <h2 class="mt-6 font-semibold">1. Selecione o Token SPL</h2>
    <select id="tokenSelect" class="w-full p-2 rounded bg-gray-700"></select>

    <h2 class="mt-6 font-semibold">2. Quantidade de tokens a enviar</h2>
    <input id="tokenAmount" type="number" placeholder="Ex: 10" class="w-full p-2 rounded bg-gray-700" oninput="updateFees()">

    <h2 class="mt-6 font-semibold">3. Carteiras de destino</h2>
    <textarea id="wallets" placeholder="Uma carteira por linha" rows="4"
      class="w-full p-2 rounded bg-gray-700" oninput="updateFees()"></textarea>

    <h2 class="mt-6 font-semibold">4. Custos</h2>
    <p id="fees" class="text-yellow-400">Taxas aparecer√£o aqui.</p>
    <p class="text-sm text-gray-400">‚ö†Ô∏è Ser√° cobrada taxa fixa de 0.00005 SOL por carteira + taxa da rede.</p>

    <button onclick="sendTokens()" class="mt-6 px-4 py-2 bg-green-600 rounded-lg hover:bg-green-700">
      Enviar Tokens
    </button>
  </div>
</body>
</html>
