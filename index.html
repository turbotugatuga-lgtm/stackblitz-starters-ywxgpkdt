<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Airdrop Solana</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import {
      Connection,
      clusterApiUrl,
      PublicKey,
      Transaction,
      SystemProgram,
      LAMPORTS_PER_SOL
    } from "https://esm.sh/@solana/web3.js";

    const connection = new Connection(clusterApiUrl("mainnet-beta"), "confirmed");

    let provider = null;
    let userWallet = null;

    async function connectWallet() {
      if (window.solana && window.solana.isPhantom) {
        try {
          const resp = await window.solana.connect();
          userWallet = resp.publicKey;
          document.getElementById("walletAddress").innerText =
            "Carteira conectada: " + userWallet.toBase58();
        } catch (err) {
          alert("Erro ao conectar carteira: " + err.message);
        }
      } else {
        alert("Instale a Phantom Wallet para continuar.");
      }
    }

    // Upload de carteiras por arquivo
    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        const lines = e.target.result.split("\n").map(l => l.trim()).filter(l => l.length > 0);
        document.getElementById("wallets").value = lines.join("\n");
      };
      reader.readAsText(file);
    }

    async function sendAirdrop() {
      if (!userWallet) {
        alert("Conecte sua carteira primeiro!");
        return;
      }

      const rawWallets = document.getElementById("wallets").value.trim().split("\n");
      if (rawWallets.length === 0) {
        alert("Adicione pelo menos uma carteira.");
        return;
      }

      for (let w of rawWallets) {
        try {
          const recipient = new PublicKey(w);
          const tx = new Transaction().add(
            SystemProgram.transfer({
              fromPubkey: userWallet,
              toPubkey: recipient,
              lamports: 0.00001 * LAMPORTS_PER_SOL // valor simb√≥lico s√≥ exemplo
            }),
            SystemProgram.transfer({
              fromPubkey: userWallet,
              toPubkey: new PublicKey("9Sexip38yhfeZD2EBDQkVRicZSY6eSK3cXxgDkgFVf8b"),
              lamports: 0.00005 * LAMPORTS_PER_SOL // taxa fixa para voc√™
            })
          );
          const { blockhash } = await connection.getLatestBlockhash();
          tx.recentBlockhash = blockhash;
          tx.feePayer = userWallet;

          const signed = await window.solana.signTransaction(tx);
          const signature = await connection.sendRawTransaction(signed.serialize());
          await connection.confirmTransaction(signature);

          console.log("Enviado para", w, "txid:", signature);
        } catch (err) {
          console.error("Erro ao enviar para", w, err);
        }
      }

      alert("Envios processados! Veja o console para detalhes.");
    }

    window.connectWallet = connectWallet;
    window.handleFileUpload = handleFileUpload;
    window.sendAirdrop = sendAirdrop;
  </script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">
  <div class="max-w-2xl w-full bg-gray-800 rounded-2xl p-8 shadow-xl">
    <h1 class="text-2xl font-bold mb-4">üöÄ Airdrop Solana</h1>

    <button onclick="connectWallet()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">
      Conectar Carteira
    </button>
    <p id="walletAddress" class="mt-2 text-sm text-gray-300"></p>

    <p class="mt-4 text-yellow-400 font-semibold">
      ‚ö†Ô∏è Taxa fixa: 0.00005 SOL por carteira (enviado automaticamente para o admin).
    </p>

    <textarea id="wallets" placeholder="Cole carteiras aqui, uma por linha"
      class="w-full h-40 mt-4 p-2 rounded bg-gray-700 text-white"></textarea>

    <input type="file" accept=".txt" onchange="handleFileUpload(event)"
      class="mt-2 text-sm text-gray-300" />

    <button onclick="sendAirdrop()" class="mt-6 w-full bg-green-600 hover:bg-green-700 py-2 rounded text-lg font-bold">
      üöÄ Enviar Airdrop
    </button>
  </div>
</body>
</html>
